from flask import Flask, request
import asyncio
import websockets

app = Flask(__name__)

async def hello(msg):
    try:
        async with websockets.connect("wss://0abd00b703f823f382d8f1b000720081.web-security-academy.net/chat") as websocket:
            await websocket.send("READY")
            message = await websocket.recv()
            await websocket.send("{\"message\":\"%s\"}" % msg)
            message = await websocket.recv()
            return message
    except Exception as e:
        print("Error:", e)
        return "nothing"

@app.route("/main")
def main():
    try:
        fuzz = request.args.get('fuzz')
        loop = asyncio.new_event_loop()
        tests = loop.run_until_complete(hello(fuzz))
        loop.close()
        return tests
    except Exception as e:
        print("Error:", e)
        return "xyz"

if __name__ == "__main__":
    app.run()
